import streamlit as st
import pandas as pd
import requests

# ç¶²é æ¨™é¡Œèˆ‡ä¸»é¡Œé¡è‰²
st.set_page_config(page_title="AI x è³‡æ–™é›†æ¢ç´¢", page_icon="ğŸ“Š", layout="wide")

st.title("ğŸ“Š è³‡æ–™é›†æ¢ç´¢èˆ‡ Gemini AI èŠå¤©åŠ©æ‰‹ ğŸ¤–")

# åˆ†é é¸æ“‡
tab1, tab2 = st.tabs(["ğŸ“‚ è³‡æ–™é›†ä¸Šå‚³", "ğŸ’¬ Gemini èŠå¤©åŠ©æ‰‹"])

# 1. è³‡æ–™é›†ä¸Šå‚³åŠŸèƒ½
with tab1:
    st.subheader("ä¸Šå‚³ CSV è³‡æ–™é›†")
    uploaded_file = st.file_uploader("è«‹é¸æ“‡ä¸€å€‹ CSV æª”æ¡ˆ", type=["csv"])
    if uploaded_file is not None:
        df = pd.read_csv(uploaded_file)
        st.success("æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼")
        st.dataframe(df)

# 2. Gemini API ä¸²æ¥åŠŸèƒ½
with tab2:
    st.subheader("èˆ‡ Gemini å°è©±")
    user_input = st.text_area("è«‹è¼¸å…¥ä½ çš„å•é¡Œï¼š", placeholder="è¼¸å…¥å•é¡Œ...")
    api_key = st.text_input("è«‹è¼¸å…¥ Gemini API é‡‘é‘°", type="password")

    if st.button("é€å‡º"):
        if api_key and user_input:
            headers = {
                "Content-Type": "application/json",
                "Authorization": f"Bearer {api_key}"
            }
            payload = {
                "contents": [{"parts": [{"text": user_input}]}]
            }
            response = requests.post(
                "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",
                headers=headers,
                json=payload,
                params={"key": api_key}
            )
            if response.status_code == 200:
                result = response.json()
                ai_text = result['candidates'][0]['content']['parts'][0]['text']
                st.write("ğŸ’¡ Gemini å›è¦†ï¼š")
                st.success(ai_text)
            else:
                st.error("è«‹ç¢ºèª API é‡‘é‘°èˆ‡è¼¸å…¥æ˜¯å¦æ­£ç¢ºã€‚")
        else:
            st.warning("è«‹è¼¸å…¥ API é‡‘é‘°èˆ‡å…§å®¹ã€‚")
